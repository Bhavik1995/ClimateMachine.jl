<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Positivity Preservation Â· ClimateMachine</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.svg" alt="ClimateMachine logo"/></a><div class="docs-package-name"><span class="docs-autofit">ClimateMachine</span></div><form class="docs-search" action="../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Getting started</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../GettingStarted/Installation/">Installation</a></li><li><a class="tocitem" href="../../../GettingStarted/Terminology/">Terminology</a></li><li><a class="tocitem" href="../../../GettingStarted/RunningClimateMachine/">Running</a></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox"/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">Defaults</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../GettingStarted/Atmos/">Atmosphere model configurations</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../generated/Atmos/heldsuarez/">Dry Idealized GCM</a></li><li><a class="tocitem" href="../../../generated/Atmos/burgers_single_stack/">Flow in Single Element Stack</a></li><li><a class="tocitem" href="../../../generated/Atmos/agnesi_hs_lin/">Linear Hydrostatic Mountain (Topography)</a></li><li><a class="tocitem" href="../../../generated/Atmos/agnesi_nh_lin/">Linear Non-Hydrostatic Mountain (Topography)</a></li><li><a class="tocitem" href="../../../generated/Atmos/risingbubble/">Rising Thermal Bubble (LES Experiment)</a></li></ul></li><li><span class="tocitem">Ocean</span></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Land</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-3-1"><span class="docs-label">Heat</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../generated/Land/Heat/heat_equation/">Heat Equation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-3-2"><span class="docs-label">Soil</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../generated/Land/Soil/Water/hydraulic_functions/">Hydraulic Functions</a></li><li><a class="tocitem" href="../../../generated/Land/Soil/Heat/bonan_heat_tutorial/">Soil Heat Equation</a></li><li><a class="tocitem" href="../../../generated/Land/Soil/Coupled/equilibrium_test/">Coupled Water and Heat</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-4-1" type="checkbox"/><label class="tocitem" for="menuitem-3-4-1"><span class="docs-label">System Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../generated/Numerics/SystemSolvers/cg/">Conjugate Gradient</a></li><li><a class="tocitem" href="../../../generated/Numerics/SystemSolvers/bgmres/">Batched Generalized Minimal Residual</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4-2" type="checkbox"/><label class="tocitem" for="menuitem-3-4-2"><span class="docs-label">DG Methods</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../generated/topo/">Topology</a></li><li><a class="tocitem" href="../../../generated/Numerics/DGMethods/showcase_filters/">Filters</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-5" type="checkbox"/><label class="tocitem" for="menuitem-3-5"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-5-1" type="checkbox"/><label class="tocitem" for="menuitem-3-5-1"><span class="docs-label">Debug</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../generated/Diagnostics/Debug/StateCheck/">State Statistics Regression</a></li></ul></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">How-to-guides</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../HowToGuides/Common/Thermodynamics/">Thermodynamics</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../HowToGuides/Atmos/TemperatureProfiles/">Temperature profiles</a></li><li><a class="tocitem" href="../../../HowToGuides/Atmos/AtmosReferenceState/">Reference profiles</a></li><li><a class="tocitem" href="../../../HowToGuides/Atmos/MoistureModelChoices/">Moisture model</a></li></ul></li><li><span class="tocitem">Ocean</span></li><li><span class="tocitem">Land</span></li><li><input class="collapse-toggle" id="menuitem-4-5" type="checkbox"/><label class="tocitem" for="menuitem-4-5"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><span class="tocitem">Meshes</span></li><li><input class="collapse-toggle" id="menuitem-4-5-2" type="checkbox"/><label class="tocitem" for="menuitem-4-5-2"><span class="docs-label">DG methods</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../HowToGuides/Numerics/DGMethods/how_to_make_a_balance_law/">How to make a balance law</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5-3" type="checkbox"/><label class="tocitem" for="menuitem-4-5-3"><span class="docs-label">ODE Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../HowToGuides/Numerics/ODESolvers/Timestepping/">Time-integration</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5-4" type="checkbox"/><label class="tocitem" for="menuitem-4-5-4"><span class="docs-label">System Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../HowToGuides/Numerics/SystemSolvers/IterativeSolvers/">Iterative Solvers</a></li></ul></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">APIs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/">Home</a></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Driver</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Driver/">Top level interface</a></li><li><a class="tocitem" href="../../../APIs/Driver/Checkpoint/">Checkpoint</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-3" type="checkbox"/><label class="tocitem" for="menuitem-5-3"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Atmos/AtmosModel/">AtmosModel</a></li><li><a class="tocitem" href="../../../APIs/Atmos/Microphysics_0M/">Microphysics_0M</a></li><li><a class="tocitem" href="../../../APIs/Atmos/Microphysics/">Microphysics</a></li><li><a class="tocitem" href="../../../APIs/Atmos/TemperatureProfiles/">Temperature Profiles</a></li></ul></li><li><a class="tocitem" href="../../../APIs/Ocean/Ocean/">Ocean</a></li><li><input class="collapse-toggle" id="menuitem-5-5" type="checkbox"/><label class="tocitem" for="menuitem-5-5"><span class="docs-label">Land</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Land/LandModel/">Land Model</a></li><li><a class="tocitem" href="../../../APIs/Land/SoilWaterParameterizations/">Soil Water Parameterizations</a></li><li><a class="tocitem" href="../../../APIs/Land/SoilHeatParameterizations/">Soil Heat Parameterizations</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-6" type="checkbox"/><label class="tocitem" for="menuitem-5-6"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Common/Orientations/">Orientations</a></li><li><a class="tocitem" href="../../../APIs/Common/Spectra/">Spectra</a></li><li><a class="tocitem" href="../../../APIs/Common/SurfaceFluxes/">Surface Fluxes</a></li><li><a class="tocitem" href="../../../APIs/Common/Thermodynamics/">Thermodynamics</a></li><li><a class="tocitem" href="../../../APIs/Common/TurbulenceClosures/">Turbulence Closures</a></li><li><a class="tocitem" href="../../../APIs/Common/TurbulenceConvection/">Turbulence Convection</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-7" type="checkbox"/><label class="tocitem" for="menuitem-5-7"><span class="docs-label">Balance Laws</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/BalanceLaws/BalanceLaws/">Balance Laws</a></li><li><a class="tocitem" href="../../../APIs/BalanceLaws/Problems/">Problems</a></li></ul></li><li><a class="tocitem" href="../../../APIs/Arrays/Arrays/">Arrays</a></li><li><input class="collapse-toggle" id="menuitem-5-9" type="checkbox"/><label class="tocitem" for="menuitem-5-9"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Diagnostics/Diagnostics/">Diagnostics groups</a></li><li><a class="tocitem" href="../../../APIs/Diagnostics/StateCheck/">State Check</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-10" type="checkbox"/><label class="tocitem" for="menuitem-5-10"><span class="docs-label">Input/Output</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/InputOutput/">Input/Output</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-11" type="checkbox"/><label class="tocitem" for="menuitem-5-11"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Numerics/Meshes/Mesh/">Meshes</a></li><li><a class="tocitem" href="../../../APIs/Numerics/SystemSolvers/SystemSolvers/">SystemSolvers</a></li><li><a class="tocitem" href="../../../APIs/Numerics/ODESolvers/ODESolvers/">ODESolvers</a></li><li><a class="tocitem" href="../../../APIs/Numerics/DGMethods/DGMethods/">DG Methods</a></li><li><a class="tocitem" href="../../../APIs/Numerics/DGMethods/Courant/">Courant</a></li><li><a class="tocitem" href="../../../APIs/Numerics/DGMethods/NumericalFluxes/">Numerical Fluxes</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-12" type="checkbox"/><label class="tocitem" for="menuitem-5-12"><span class="docs-label">Utilities</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Utilities/VariableTemplates/">Variable Templates</a></li><li><a class="tocitem" href="../../../APIs/Utilities/SingleStackUtils/">Single Stack Utilities</a></li><li><a class="tocitem" href="../../../APIs/Utilities/TicToc/">Tic Toc</a></li></ul></li></ul></li><li><a class="tocitem" href="../../../Contributing/">Contribution guide</a></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox" checked/><label class="tocitem" for="menuitem-7"><span class="docs-label">Theory</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-7-1" type="checkbox"/><label class="tocitem" for="menuitem-7-1"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Common/SurfaceFluxes/">SurfaceFluxes</a></li><li><a class="tocitem" href="../../Common/Turbulence/">Turbulence Closures</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7-2" type="checkbox"/><label class="tocitem" for="menuitem-7-2"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Atmos/AtmosModel/">AtmosModel</a></li><li><a class="tocitem" href="../../Atmos/Microphysics_0M/">Microphysics_0M</a></li><li><a class="tocitem" href="../../Atmos/Microphysics/">Microphysics</a></li><li><a class="tocitem" href="../../Atmos/EDMFEquations/">EDMF equations</a></li><li><a class="tocitem" href="../../Atmos/Model/tracers/">Tracers</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7-3" type="checkbox" checked/><label class="tocitem" for="menuitem-7-3"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>Positivity Preservation</a><ul class="internal"><li><a class="tocitem" href="#Flux-correction"><span>Flux correction</span></a></li><li><a class="tocitem" href="#Rescaling"><span>Rescaling</span></a></li><li><a class="tocitem" href="#Limitations"><span>Limitations</span></a></li><li><a class="tocitem" href="#Results"><span>Results</span></a></li></ul></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-8" type="checkbox"/><label class="tocitem" for="menuitem-8"><span class="docs-label">Developer docs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../DevDocs/CodeStyle/">Coding style</a></li><li><a class="tocitem" href="../../../DevDocs/AcceptableUnicode/">Acceptable Unicode</a></li><li><a class="tocitem" href="../../../DevDocs/VariableList/">Variable list</a></li><li><a class="tocitem" href="../../../DevDocs/DiagnosticVariables/">Diagnostic variable list</a></li><li><a class="tocitem" href="../../../DevDocs/SystemImage/">Custom System Image</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Theory</a></li><li><a class="is-disabled">Numerics</a></li><li class="is-active"><a href>Positivity Preservation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Positivity Preservation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/ClimateMachine.jl/blob/master/docs/src/Theory/Numerics/MPP.md" title="Edit on GitHub"><span class="docs-icon fab">ï</span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Positivity-Preservation"><a class="docs-heading-anchor" href="#Positivity-Preservation">Positivity Preservation</a><a id="Positivity-Preservation-1"></a><a class="docs-heading-anchor-permalink" href="#Positivity-Preservation" title="Permalink"></a></h1><p>It is important to preserve positive sign of active tracers,   such as the mass fraction of the suspended or precipitating water. The tracer mass may unphysically turn negative because of the   numerical errors caused either by the advection scheme,   or by time integration of source terms. The algorithm described here ensures positivity when solving the   advection-(TODO: diffusion) problem and falls under the   Maximum Principle Preserving (MPP) algorithm category. Ensuring positivity while integrating source terms is left as future work.</p><p>The implementation follows <a href="https://journals.ametsoc.org/mwr/article/144/12/4771/70817/Preserving-Nonnegativity-in-Discontinuous-Galerkin">Light_and_Durran_2016</a> and <a href="https://epubs.siam.org/doi/10.1137/140965326">Xiong_et_al_2015</a>. Positivity preservation is done in two steps:</p><ul><li>Flux correction is applied to those DG elements, whose average value would otherwise turn negative at the end of the time step.</li><li>An adjustment is applied to nodal points inside the element that truncates the negative nodal points to zero and adjusts the values of the remaining points to preserve the element average.</li></ul><p>The MPP algorithm can be applied to a user-defined sub-set of state variables.</p><h2 id="Flux-correction"><a class="docs-heading-anchor" href="#Flux-correction">Flux correction</a><a id="Flux-correction-1"></a><a class="docs-heading-anchor-permalink" href="#Flux-correction" title="Permalink"></a></h2><p>The flux correction is implemented following   <a href="https://epubs.siam.org/doi/10.1137/140965326">Xiong_et_al_2015</a>. Because of the efficiency concerns, the correction is applied only   at the last stage of the Runge-Kutta (RK) algorithm. As a result the positivity is preserved only at the final timestepping stage   and not during the intermediate RK stages. The correction is obtained with the help of a finite volume (FV) scheme   (i.e. low order scheme) running in parallel with the DG scheme   (i.e. high order scheme). A low order FV scheme perserves the minima/maxima   and provides a bound on how big a DG flux through an element face can be   to preserve positivity. Below we show the algorithm for the 1-dimensional case.</p><p>Let <span>$H_{j+\frac{1}{2}}$</span> and <span>$h_{j+\frac{1}{2}}$</span> denote   the high order and low order scheme fluxes   through element face <span>$j+\frac{1}{2}$</span> of the DG element <span>$j$</span>. Additionally let <span>$F_{j+\{1}{2}}$</span> denote the difference   between the high and low order scheme fluxes   through element face <span>$j+\frac{1}{2}$</span>:</p><div>\[  F_{j+\frac{1}{2}} = H_{j+\frac{1}{2}} - h_{j+\frac{1}{2}}\]</div><p>The corrected <span>$\hat{H}_{j+\frac{1}{2}}$</span> flux through   the face <span>$j+\frac{1}{2}$</span> is computed with the limiter   <span>$\theta_{j+\frac{1}{2}}$</span>:</p><div>\[\hat{H}_{j+\frac{1}{2}} = \theta_{j+\frac{1}{2}} H_{j+\frac{1}{2}} + (1 - \theta_{j+\frac{1}{2}}) h_{j+\frac{1}{2}}\]</div><p>If <span>$H_{j+\frac{1}{2}}$</span> does not cause negative numbers,   <span>$\theta_{j+\frac{1}{2}}$</span> is set to 1   and the final DG solution is not changed. Otherwise</p><div>\[\theta_{j+\frac{1}{2}} = min(\Lambda_{j+\frac{1}{2}}, \Lambda_{j+1-\frac{1}{2}})\]</div><p>where <span>$\Lambda_{j+\frac{1}{2}}$</span> is the helper limiter concerned with   the flux out of element <span>$j$</span>   and <span>$\Lambda_{j+1-\frac{1}{2}}$</span> is the helper limiter concerned with   the flux out of element <span>$j+1$</span>. The helper limiter is defined as</p><div>\[\Lambda_{j+\frac{1}{2}} = \frac{\phi^{t+1}_{j, FV} - \phi_{min}}{\frac{\Delta t}{\Delta x} \Delta F_{j, out}}\]</div><p>where:</p><ul><li><span>$\phi_{min} = 0$</span> is the minimum allowed value</li><li><span>$\phi^{n+1}_{j, FV} = \phi^{n}_{j, FV} - \frac{\Delta t}{\Delta x} (h_{j+\frac{1}{2}} - h_{j-\frac{1}{2}})$</span>   is the advection diffusion solution of the FV scheme</li><li><span>$\Delta F_{j, out} = max(0, F_{j+\frac{1}{2}}) + max(0, F_{j-\frac{1}{2}})$</span>   is the sum of the flux differences between the DG and FV schemes   for element <span>$j$</span>, but only those contributions where DG overestimates   the flux compared to FV</li><li><span>$\Delta t$</span> is the model time step</li><li><span>$\Delta x_j$</span> is the FV grid resolution.</li></ul><p>The nominator represents the maximum scalar concentration   that can be moved out of the DG element in a given time step,   based on the FV scheme. The denominator sums the &quot;overshoots&quot; from the DG scheme   compared to the FV scheme that would result in negative average element value. Notice that the limiter on the <span>$j+\frac{1}{2}$</span> face potentially depends   on all the fluxes going in/out of the element <span>$j$</span>. The MPP implementation requires additional memory allocated to store the   FV solutions for all elements and the limiters on all the element faces. See <a href="https://epubs.siam.org/doi/10.1137/140965326">Xiong_et_al_2015</a>   for the full derivation   (eq. 2.12 and above define the limiters in a more detailed way).</p><h2 id="Rescaling"><a class="docs-heading-anchor" href="#Rescaling">Rescaling</a><a id="Rescaling-1"></a><a class="docs-heading-anchor-permalink" href="#Rescaling" title="Permalink"></a></h2><p>The rescaling is implemented following   <a href="https://journals.ametsoc.org/mwr/article/144/12/4771/70817/Preserving-Nonnegativity-in-Discontinuous-Galerkin">Light_and_Durran_2016</a>   Chapter 3. For scalar <span>$\phi$</span> in DG element <span>$j$</span> with nodal points <span>$k$</span>   the truncation is:</p><div>\[\phi_{j,k}^{+} = \left\{
    \begin{array}{ll}
        \phi_{j,k} &amp; \mathrm{if} \;\; \phi_{j,k} \geq 0 \\
        0 &amp; \mathrm{if} \;\; \phi_{j,k} &lt; 0
    \end{array}
\right.\]</div><p>The rescaling factor is computed as:</p><div>\[r_j = \frac{\overline{\phi_j}}{\overline{\phi_j^+}}\]</div><p>where:</p><ul><li><span>$\overline{\phi_{j}}$</span> and <span>$\overline{\phi_j^+}$</span> denote the average element value before and after the truncation.</li></ul><p>Finally, the rescaled nodal point values <span>$\phi_{j,k}^{*}$</span> are defined as:</p><div>\[\phi_{j,k}^{*} = \left\{
    \begin{array}{ll}
        r_j \phi_{j,k} &amp; \mathrm{if} \;\; \phi_{j,k} \geq 0 \\
        0 &amp; \mathrm{if} \;\; \phi_{j,k} &lt; 0
    \end{array}
\right.\]</div><p>The flux correction guarantees that the average element value is non-negative. Because of this, the above truncation and mass adjustment, will not introduce   any additional mass into the system.</p><h2 id="Limitations"><a class="docs-heading-anchor" href="#Limitations">Limitations</a><a id="Limitations-1"></a><a class="docs-heading-anchor-permalink" href="#Limitations" title="Permalink"></a></h2><ul><li><p>The MPP algorithm is only tested with LSRK explicit timesteppers.</p></li><li><p>Positivity is ensured only at the last RK stage.</p></li><li><p>This approach could potentailly be extended to offer a local limiter, along the lines of limiters for finite volume schemes in <a href="https://journals.ametsoc.org/mwr/article/117/11/2626/64201/Comment-on-A-Positive-Definite-Advection-Scheme">Smolarkiewicz_1989</a>. Such application for DG is not described in the literature. Not sure how effective it would be. For our application one would have to additionally deal with divergence and CFL &gt; 1.</p></li></ul><h2 id="Results"><a class="docs-heading-anchor" href="#Results">Results</a><a id="Results-1"></a><a class="docs-heading-anchor-permalink" href="#Results" title="Permalink"></a></h2><p>TODO - Once the interface with Clima is implemented I&#39;ll add here a   test/usage example. It will either be the 1D-box filter showcase   or the cone test from Light and Durran 2016.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../Atmos/Model/tracers/">Â« Tracers</a><a class="docs-footer-nextpage" href="../../../DevDocs/CodeStyle/">Coding style Â»</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Saturday 26 September 2020 01:18">Saturday 26 September 2020</span>. Using Julia version 1.5.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
